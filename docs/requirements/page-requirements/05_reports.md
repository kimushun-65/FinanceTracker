# レポートページ 設計書

## ページ概要
指定した日付範囲内の収入と支出の結果を表示し、メールで送信できるページです。シンプルな収支サマリーとカテゴリ別内訳を提供します。

## 主要機能

### 1. レポート期間選択
- **日付範囲選択**: 開始日と終了日を指定
- **カレンダーUI**: 日付選択用のカレンダー
- **クイック選択**: 今月、先月、過去3ヶ月、今年

### 2. 収支サマリー表示
- **総収入**: 期間内の収入合計額
- **総支出**: 期間内の支出合計額
- **収支バランス**: 収入と支出の差額

### 3. カテゴリ別内訳
- **支出内訳テーブル**:
  - カテゴリ名
  - 支出額
  - 全体に占める割合（%）
- **収入内訳テーブル**:
  - 収入源
  - 金額
  - 全体に占める割合（%）

### 4. メール送信機能
- **ワンクリック送信**: 右上のボタンから即座にメール送信
- **送信内容**: 現在表示中のレポート内容
- **宛先**: ユーザーのメールアドレス（自動設定）

## データ取得要件

### 必要なAPI（既存APIを利用）
1. **収支サマリー取得**
   - エンドポイント: `GET /transactions/summary`
   - パラメータ:
     - from: 開始日
     - to: 終了日
     - group_by: category（カテゴリ別集計）
   - レスポンス: カテゴリ別の収入・支出データ

2. **メール送信**
   - エンドポイント: `POST /reports/email`
   - リクエスト:
     ```json
     {
       "type": "custom",
       "from": "2025-01-01",
       "to": "2025-01-31",
       "recipient_email": "user@example.com"
     }
     ```
   - レスポンス: 送信確認メッセージ

### データベース参照
- `transactions`テーブル: 取引データ
- `categories`テーブル: カテゴリ情報
- `budgets`テーブル: 予算比較用

## UI/UX要件

### レイアウト
- **レスポンシブデザイン**: PC/タブレット/スマホ対応
- **印刷レイアウト**: A4サイズ最適化
- **グラフサイズ**: 画面幅に応じて自動調整

### インタラクティブ要素
- **グラフホバー**: 詳細数値表示
- **ズーム機能**: 特定期間の拡大表示
- **ドラッグ選択**: 期間選択の直感的操作

### パフォーマンス
- **レポート表示**: 3秒以内
- **メール送信**: 即座に実行

## メール送信仕様

### メールフォーマット
- **件名**: 自動生成（例:「収支レポート 2025/01/01 - 2025/01/31」）
- **本文**: レポート内容をテキスト形式で記載
- **宛先**: ユーザー登録メールアドレス

### 送信内容
- 期間
- 収入合計・支出合計・収支バランス
- カテゴリ別内訳（上位5カテゴリ）

## 実装優先順位
1. 期間選択機能
2. 収支サマリー表示
3. カテゴリ別内訳テーブル
4. メール送信機能

## 画面設計（ASCII）

```
+--------------------------------------------------------------------------------------------------+
|  FinSight                                                     AI User | Premium Plan [📧 Email]  |
+----------------+---------------------------------------------------------------------------------+
| ≡ Dashboard    |                              Income/Expense Report                               |
|                |                                                                                 |
| 📊 Transactions | Report Period: [Start Date: 2025-09-01] ~ [End Date: 2025-09-30]              |
|                |                                                                                 |
| 💰 Budget       | Income/Expense Summary                                                          |
|                | +-----------------------------------------------------------------------+       |
| 📈 Assets       | | Total Income:                                      ¥450,000         |       |
|                | | Total Expenses:                                   ¥106,672         |       |
| 📑 Reports      | | Balance:                                          ¥343,328         |       |
|                | +-----------------------------------------------------------------------+       |
| ⚙️ Settings     |                                                                                 |
|                | Expense Details by Category                                                     |
|                | +-----------------------------------------------------------------------+       |
|                | | Category            | Amount        | % of Total                     |       |
|                | |--------------------|---------------|--------------------------------|       |
|                | | Food (食費)         | ¥33,368      | 31.3%                          |       |
|                | | Household (家賃)    | ¥24,964      | 23.4%                          |       |
|                | | Others (その他)     | ¥16,605      | 15.6%                          |       |
|                | | Entertainment      | ¥16,361      | 15.3%                          |       |
|                | | Transportation     | ¥10,301      | 9.7%                           |       |
|                | | Utilities (光熱費)  | ¥5,073       | 4.8%                           |       |
|                | |                    |               |                                |       |
|                | | Total              | ¥106,672     | 100%                           |       |
|                | +-----------------------------------------------------------------------+       |
|                |                                                                                 |
|                | Income Details                                                                  |
|                | +-----------------------------------------------------------------------+       |
|                | | Source             | Amount        | % of Total                     |       |
|                | |--------------------|---------------|--------------------------------|       |
|                | | Salary             | ¥400,000     | 88.9%                          |       |
|                | | Bonus              | ¥50,000      | 11.1%                          |       |
|                | |                    |               |                                |       |
|                | | Total              | ¥450,000     | 100%                           |       |
|                | +-----------------------------------------------------------------------+       |
|                |                                                                                 |
+----------------+---------------------------------------------------------------------------------+
```

### 画面要素説明

#### メール送信ボタン（右上）
- **📧 Email**: クリックで現在表示中のレポートをメール送信
- ユーザー名の横に配置
- ワンクリックで送信完了

#### 期間選択（上部）
- 開始日と終了日を個別に選択
- カレンダーUI使用
- クイック選択: 今月、先月、過去3ヶ月、今年

#### 収支サマリー（上部）
- **総収入**: 期間内の収入合計
- **総支出**: 期間内の支出合計
- **収支バランス**: 収入－支出の差額

#### カテゴリ別支出表（中央上）
- シンプルなテーブル形式
- カテゴリ名（日本語併記）
- 金額と全体に占める割合

#### 収入内訳表（中央下）
- 収入源別の内訳
- 金額と割合表示