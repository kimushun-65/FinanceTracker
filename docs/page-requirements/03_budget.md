# 予算管理ページ 設計書

## ページ概要
月別の予算設定と実績管理を行うページです。カテゴリごとの予算設定、消化状況の可視化、AIによる予算提案機能を提供します。

## 主要機能

### コアビジネス機能
- **月別予算管理**: カテゴリ別の予算設定・管理
- **リアルタイム進捗監視**: 予算消化状況の即座反映
- **AIベース予算提案**: 過去データに基づいた最適予算提案
- **予算超過アラート**: 逐次的警告システム

### 1. 予算概要セクション
- **総予算額表示**: 全カテゴリの予算合計
- **カテゴリ別予算**:
  - 食費
  - 交通費
  - 家賃・住居費
  - エンターテインメント
  - 光熱費
  - その他
- **表示内容（各カテゴリ）**:
  - 予算額
  - 実績額
  - 進捗バー（パーセント表示）
  - 残額または超過額

### 2. 進捗表示
- **進捗バーの色分け**:
  - 0-70%: 緑色（安全圏）
  - 70-90%: 黄色（注意）
  - 90-100%: オレンジ（警告）
  - 100%超: 赤色（超過）
- **数値表示**: 「実績額 / 予算額」形式

### 3. 予算編集機能
- **インライン編集**: 各カテゴリの予算額をクリックして編集
- **一括編集モード**: 全カテゴリの予算を同時編集
- **保存ボタン**: 変更内容の保存
- **リセット機能**: 前月の予算をコピー

### 4. AI予算提案機能
- **「予算プラン生成」ボタン**: AIによる最適予算案の生成
- **提案内容表示**:
  - カテゴリ別推奨予算額
  - 前月実績との比較
  - 改善ポイントの説明
- **提案の適用**: ワンクリックで提案内容を反映

### 5. 前月実績表示
- **前月の支出実績**: カテゴリ別実績額
- **前月比較**: 当月実績との差分表示
- **トレンド表示**: 3ヶ月の推移グラフ

## 対応API・テーブル・ドメイン情報

### 関連API
1. **GET /budgets/current**
   - 現在月の予算情報取得（リアルタイム進捗計算含む）
   - レスポンス: カテゴリ別予算・実績・進捗率・アラート情報

2. **GET /budgets/{year-month}**
   - 指定月の予算情報取得
   - パラメータ: year-month (YYYY-MM)
   - 過去月の予算実績参照用

3. **POST /budgets**
   - 月別予算新規作成
   - リクエスト: カテゴリ別予算額配列
   - バリデーション: 総額制限・最小予算額チェック

4. **PUT /budgets/{year-month}**
   - 予算情報更新（インライン編集、一括編集）
   - リアルタイムの進捗率更新を伴う

5. **POST /budgets/ai-suggestions**
   - AIによる予算最適化提案
   - パラメータ: target_month, optimization_type
   - 過去実績をベースにした推奨予算案

6. **GET /budgets/history**
   - 過去3ヶ月の予算・実績トレンド取得
   - 比較グラフ表示用

### 対応テーブル
- **budgets**: 月別カテゴリ別予算設定（月, カテゴリ, 予算額）
- **budget_suggestions**: AI提案履歴（提案理由、適用状況）
- **transactions**: 実績計算用ソースデータ（カテゴリ別支出集計）
- **categories**: 予算対象カテゴリマスタ

### 関連ドメインエンティティ
- **Budget集約**: 予算計画のライフサイクル管理
  - Budgetエンティティ: 月別カテゴリ別予算
  - BudgetStatus値オブジェクト: 進捗率・アラートレベル計算
  - Month値オブジェクト: 月度管理
- **BudgetSuggestion集約**: AI提案ロジックと履歴管理
- **Transaction集約**: 実績データ参照（予算照合用）
- **Category集約**: 予算カテゴリ分類ロジック

## UI/UX要件

### ビジュアル要素
- **プログレスバー**: アニメーション付き
- **数値変更**: トランジション効果
- **超過警告**: 点滅またはハイライト表示

### インタラクティブ要素
- **ドラッグ調整**: スライダーで予算額調整
- **クイック設定**: +1000円/-1000円ボタン
- **プリセット**: よくある予算パターン選択

### 通知機能
- **予算超過アラート**: 90%到達時
- **月初リマインダー**: 予算設定促進
- **AIからの提案通知**: 改善余地がある場合

## ビジネスロジック

### 予算計算ルール
- **デフォルト予算**: 前月実績の平均値
- **最小予算額**: カテゴリごとに0円以上
- **合計制限**: 収入予測の範囲内で警告

### AI提案ロジック
- **分析対象**: 過去3-6ヶ月の実績
- **考慮要素**:
  - 季節性（光熱費など）
  - トレンド（増加/減少傾向）
  - 類似ユーザーとの比較
- **提案精度**: 信頼度スコア表示

## 実装優先順位
1. 基本的な予算表示・編集機能
2. 実績との対比表示
3. 進捗バーとビジュアル表現
4. AI予算提案機能
5. 高度な分析・比較機能

## 画面設計（ASCII）

```
+--------------------------------------------------------------------------------------------------+
|  FinSight                                                               AI User | Premium Plan    |
+----------------+---------------------------------------------------------------------------------+
| ≡ Dashboard    |                              Budget Management                                  |
|                |                                                                                 |
| 📊 Transactions | Budget Overview                               AI Budget Suggestions             |
|                | +------------------------------------------+  +-------------------------------+ |
| 💰 Budget       | | Total Budget: ¥200,000                   |  | 💡 AI Recommendations          | |
|                | |                                          |  |                               | |
| 📈 Assets       | | Food (食費)                              |  | Based on your spending:       | |
|                | | ¥33,368 / ¥50,000     [████████░░] 67% |  |                               | |
| 📑 Reports      | |                                          |  | • Food budget can be reduced  | |
|                | | Transportation (交通費)                   |  |   to ¥45,000 based on past   | |
| ⚙️ Settings     | | ¥10,301 / ¥10,000     [██████████] 103%|  |   3 months average            | |
|                | |                        ⚠️ Over budget     |  |                               | |
|                | |                                          |  | • Consider increasing Trans-  | |
|                | | Household (家賃)                          |  |   portation to ¥12,000       | |
|                | | ¥24,964 / ¥90,000     [██░░░░░░░░] 28% |  |                               | |
|                | |                                          |  | • Entertainment spending is   | |
|                | | Entertainment (エンタメ)                  |  |   within healthy range        | |
|                | | ¥16,361 / ¥20,000     [████████░░] 82% |  |                               | |
|                | |                                          |  | Estimated savings: ¥8,000/mo  | |
|                | | Utilities (光熱費)                        |  |                               | |
|                | | ¥5,073 / ¥15,000      [███░░░░░░░] 34% |  +-------------------------------+ |
|                | |                                          |                                    |
|                | | Others (その他)                           |  Previous Month Expenses           |
|                | | ¥16,605 / ¥15,000     [██████████] 111%|  +-------------------------------+ |
|                | |                        ⚠️ Over budget     |  | Food:           ¥35,220       | |
|                | +------------------------------------------+  | Transportation: ¥9,850        | |
|                |                                                | Household:      ¥90,000       | |
|                | [Save Budget] [Generate Budget Plan]          | Entertainment:  ¥18,930       | |
|                |                                                | Utilities:      ¥4,890        | |
|                |                                                | Others:         ¥12,340       | |
|                |                                                +-------------------------------+ |
+----------------+---------------------------------------------------------------------------------+
```

### 画面要素説明

#### 予算概要エリア（左側メイン）
- **総予算額**: 上部に大きく表示
- **カテゴリ別予算**:
  - カテゴリ名（日本語併記）
  - 実績額 / 予算額
  - プログレスバー（色分け）
  - パーセント表示
  - 超過時は警告アイコン

#### プログレスバーの色
- 緑（0-70%）: 安全圏
- 黄（70-90%）: 注意
- オレンジ（90-100%）: 警告
- 赤（100%超）: 超過

#### AI予算提案エリア（右上）
- 💡アイコンで視覚的に識別
- 箇条書きで具体的な提案
- 予想節約額の表示

#### 前月実績エリア（右下）
- シンプルなリスト形式
- 比較しやすい配置

#### アクションボタン
- **Save Budget**: 編集内容を保存
- **Generate Budget Plan**: AI提案を生成