# モバイルアプリ 設計書

## アプリ概要
外出先での素早い支出入力に特化したモバイル版アプリです。シンプルなUIで、最小限の操作で取引を記録できることを重視します。

## 主要機能

### 1. クイック入力画面（メイン画面）
- **金額入力**:
  - 大型数字表示エリア
  - テンキーパッド
  - 計算機能（+、-、×、÷）
  - クリアボタン
- **カテゴリ選択**:
  - ドロップダウンまたはアイコングリッド
  - 最近使用したカテゴリを上位表示
  - 頻度に基づく自動並び替え
- **店舗名入力**:
  - テキスト入力フィールド
  - 位置情報に基づく店舗サジェスト
  - 履歴からの自動補完
- **日付選択**:
  - デフォルトは今日
  - カレンダーピッカー
  - 「昨日」「今日」クイックボタン

### 2. 予算状況表示
- **当月予算バー**:
  - 使用額/予算額の視覚的表示
  - 残額の大きな数字表示
  - 予算超過時の警告表示
- **カテゴリ別ミニグラフ**:
  - 主要カテゴリの使用状況
  - タップで詳細表示

### 3. 最近の取引表示
- **直近3-5件の取引リスト**:
  - 金額
  - カテゴリアイコン
  - 日付
  - 簡易編集（スワイプ）
- **もっと見る**: 取引一覧画面へ遷移

### 4. ボトムナビゲーション
- **ホーム**: クイック入力画面
- **履歴**: 取引一覧
- **レポート**: 簡易レポート表示
- **設定**: アプリ設定

### 5. 追加機能
- **レシート撮影**: OCRによる自動入力（将来実装）
- **音声入力**: 「コンビニで500円」等
- **ウィジェット**: ホーム画面からの直接入力
- **ショートカット**: 3D Touch/長押しメニュー

## 画面遷移

```
ホーム（クイック入力）
├── 取引詳細
├── 取引一覧
│   └── 取引編集
├── 簡易レポート
│   └── 詳細レポート（Web版へ）
└── 設定
    ├── カテゴリ設定
    ├── 通知設定
    └── アカウント設定
```

## データ同期要件

### オンライン時
- **即時同期**: 入力完了後すぐにサーバー送信
- **プッシュ同期**: 他デバイスでの変更を受信
- **同期インジケータ**: 同期状態の表示

### オフライン時
- **ローカル保存**: SQLiteまたはCore Data
- **キュー管理**: 未同期データの管理
- **自動再送**: 接続復帰時の自動同期
- **競合解決**: タイムスタンプベース

## UI/UX要件

### 操作性
- **片手操作**: 画面下部に主要ボタン配置
- **大きなタップエリア**: 44pt以上
- **スワイプジェスチャー**: 
  - 左右: 日付変更
  - 上下: 金額調整
- **触覚フィードバック**: 入力確定時

### パフォーマンス
- **起動時間**: 2秒以内
- **入力レスポンス**: 即座に反映
- **アニメーション**: 60fps維持

### アクセシビリティ
- **VoiceOver対応**: 全要素にラベル設定
- **Dynamic Type**: テキストサイズ調整
- **カラーコントラスト**: WCAG AA準拠

## プラットフォーム別仕様

### iOS
- **最小バージョン**: iOS 14.0以上
- **フレームワーク**: SwiftUI
- **データ保存**: Core Data
- **通知**: Push Notification
- **生体認証**: Face ID/Touch ID

### Android
- **最小バージョン**: Android 6.0以上
- **フレームワーク**: Jetpack Compose
- **データ保存**: Room
- **通知**: Firebase Cloud Messaging
- **生体認証**: BiometricPrompt

## 特殊機能

### 位置情報連携
- **自動店舗検出**: GPSで近隣店舗を特定
- **カテゴリ推定**: 店舗種別から自動設定
- **プライバシー設定**: 位置情報利用の制御

### ウィジェット機能
- **今月の支出表示**: 金額と進捗
- **クイック入力**: タップで入力画面起動
- **最近の取引**: 直近3件表示

### Apple Watch/Wear OS対応
- **支出入力**: 音声または定型金額
- **予算確認**: 残額表示
- **通知**: 予算超過アラート

## セキュリティ要件

### 認証
- **生体認証**: 起動時オプション
- **PINコード**: 代替認証手段
- **自動ロック**: 一定時間後

### データ保護
- **ローカル暗号化**: 金額データの暗号化
- **通信暗号化**: TLS 1.3
- **キーチェーン/キーストア**: 認証情報保存

## 実装優先順位
1. 基本的なクイック入力機能
2. オフライン対応とデータ同期
3. 取引一覧と編集機能
4. ウィジェット実装
5. 高度な機能（OCR、音声入力等）

## 画面設計（ASCII）

```
┌─────────────────────────┐
│ 📱 FinSight      19:30  │
├─────────────────────────┤
│                         │
│     Current Expense     │
│                         │
│      ¥ 7,450           │
│                         │
│  ━━━━━━━━━━━━━━━━━━━━  │
│  ████████████░░░░░░░░░  │
│  ━━━━━━━━━━━━━━━━━━━━  │
│                         │
│  ¥11,763 left of       │
│  ¥100,000 budget       │
│                         │
├─────────────────────────┤
│                         │
│  ┌───┬───┬───┐         │
│  │ 7 │ 8 │ 9 │         │
│  ├───┼───┼───┤         │
│  │ 4 │ 5 │ 6 │         │
│  ├───┼───┼───┤         │
│  │ 1 │ 2 │ 3 │         │
│  ├───┼───┼───┤         │
│  │ 0 │ . │ ← │         │
│  └───┴───┴───┘         │
│                         │
├─────────────────────────┤
│ Category:               │
│ ┌─────────────────────┐ │
│ │ 🍎 Food         ▼  │ │
│ └─────────────────────┘ │
│                         │
│ Store (Optional):       │
│ ┌─────────────────────┐ │
│ │ スーパー_          │ │
│ └─────────────────────┘ │
│                         │
│ Date:                   │
│ ┌─────────────────────┐ │
│ │ 2025/09/30    📅   │ │
│ └─────────────────────┘ │
│                         │
│ ┌─────────────────────┐ │
│ │    登録 (Save)      │ │
│ └─────────────────────┘ │
│                         │
├─────────────────────────┤
│ Recent Transactions     │
├─────────────────────────┤
│ Today          ¥10,230  │
│ ┌─────────────────────┐ │
│ │🍎 Lunch      ¥1,200 │ │
│ │🚃 Train       ¥280  │ │
│ │🛍️ Amazon    ¥8,750 │ │
│ └─────────────────────┘ │
├─────────────────────────┤
│  🏠    📊    ➕    ⚙️   │
│ Home  Stats  Add  More  │
└─────────────────────────┘
```

### 画面要素説明

#### ヘッダー（最上部）
- アプリ名とアイコン
- 現在時刻
- 同期状態インジケータ

#### 支出表示エリア
- **現在の入力金額**: 大きな文字で中央表示
- **予算プログレスバー**: 視覚的な消化状況
- **残り予算**: テキストで補足情報

#### テンキーパッド
- 0-9の数字キー
- 小数点キー
- バックスペースキー
- 大きめのタップエリア（44pt以上）

#### 入力フォーム
- **カテゴリ選択**: ドロップダウン
- **店舗名**: テキスト入力（オプション）
- **日付**: カレンダーピッカー付き
- **登録ボタン**: 目立つ色でCTA

#### 最近の取引
- 本日の合計額
- 直近3件の取引リスト
- カテゴリアイコン付き

#### ボトムナビゲーション
- Home: クイック入力（現在地）
- Stats: 簡易統計
- Add: 取引追加（中央強調）
- More: その他メニュー

### タブレット版レイアウト（横向き）

```
┌──────────────────────────────────────────────────────────┐
│ 📱 FinSight                                        19:30  │
├────────────────────────────┬─────────────────────────────┤
│                            │  Recent Transactions        │
│      Current Expense       │                             │
│                            │  Today              ¥10,230 │
│        ¥ 7,450            │  ├─ 🍎 Lunch         ¥1,200 │
│                            │  ├─ 🚃 Train          ¥280  │
│   ████████████░░░░░░░░    │  └─ 🛍️ Amazon       ¥8,750 │
│                            │                             │
│   ¥11,763 left of         │  Yesterday          ¥5,420  │
│   ¥100,000 budget         │  ├─ 🍎 Dinner        ¥2,100 │
│                            │  ├─ ⚡ Electricity   ¥3,320 │
├────────────────────────────┤                             │
│  ┌───┬───┬───┐  Category: │  This Month       ¥106,672 │
│  │ 7 │ 8 │ 9 │  [🍎 Food▼]│                             │
│  ├───┼───┼───┤            ├─────────────────────────────┤
│  │ 4 │ 5 │ 6 │  Store:    │  Budget Progress            │
│  ├───┼───┼───┤  [_______] │                             │
│  │ 1 │ 2 │ 3 │            │  Food     ████████░░ 80%    │
│  ├───┼───┼───┤  Date:     │  Trans    ██████████ 100%   │
│  │ 0 │ . │ ← │  [Today ▼] │  Utils    ███░░░░░░░ 30%    │
│  └───┴───┴───┘            │  Others   █████████░ 90%    │
│                            │                             │
│    [ 登録 (Save) ]         │  [View All Transactions]    │
└────────────────────────────┴─────────────────────────────┘
```