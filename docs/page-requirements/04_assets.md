# 資産管理ページ 設計書

## ページ概要
複数の金融口座を統合管理し、総資産の把握と将来予測を行うページです。預金、投資信託、株式などの資産を一元管理します。

## 主要機能

### コアビジネス機能
- **総合資産管理**: 複数口座の一元管理と総資産把握
- **資産推移分析**: 時系列データによる資産変動の可視化
- **AI予測エンジン**: 過去データベースの将来資産予測
- **多種口座対応**: 預金・投資・株式等の統合管理

### 1. 総資産表示
- **大型数値表示**: 全口座の合計資産額
- **前月比**: 増減額と増減率（%）
- **更新日時**: 最終データ同期日時

### 2. 資産内訳リスト
- **表示項目（各口座）**:
  - 口座名称
  - 口座種別（普通預金、投資信託、株式等）
  - 現在残高
  - 構成比率（%）
  - 前月比増減
- **並び替え**: 残高順、種別順、名称順
- **グルーピング**: 種別ごとにグループ化表示

### 3. 口座管理機能
- **口座追加**:
  - 口座名称入力
  - 口座種別選択
  - 初期残高設定
- **口座編集**: 名称変更、残高更新
- **口座削除**: 確認後に削除（取引履歴は保持）
- **手動更新**: 残高の手動入力・更新

### 4. 資産推移グラフ
- **グラフタイプ**: 面グラフ（積み上げ）
- **表示期間**: 1ヶ月、3ヶ月、6ヶ月、1年、全期間
- **表示内容**: 口座種別ごとの推移
- **インタラクティブ**: ホバーで詳細表示

### 5. 簡易資産予測機能
- **予測開始ボタン**: 将来の資産額簡易予測を実行
- **予測パラメータ**:
  - 予測期間（1年、3年、5年）
  - シナリオ（楽観的、現実的、悲観的）
- **予測結果表示**:
  - 予測資産額
  - 予測グラフ
  - 前提条件の説明

## 対応API・テーブル・ドメイン情報

### 関連API
1. **GET /accounts**
   - 全口座一覧取得（種別別グルーピング含む）
   - レスポンス: 口座情報、現在残高、構成比、前月比

2. **POST /accounts**
   - 新規口座作成
   - リクエスト: 口座名、種別、初期残高
   - バリデーション: 重複チェック、残高範囲チェック

3. **PUT /accounts/{id}**
   - 口座情報更新（名前、種別変更）
   - 残高更新は別エンドポイント

4. **DELETE /accounts/{id}**
   - 口座削除（論理削除、履歴は保持）
   - 関連取引・資産スナップショットの処理

5. **POST /accounts/{id}/balance**
   - 手動残高更新
   - リクエスト: 新残高、更新日時
   - 履歴記録と日次スナップショット更新

6. **GET /assets/snapshots**
   - 資産推移履歴取得（グラフ用）
   - パラメータ: from, to, granularity
   - 日次・週次・月次集計対応

7. **POST /assets/forecasts**
   - 簡易資産予測実行
   - パラメータ: horizon_months, scenario
   - 過去トレンド、収支パターンを考慮

### 対応テーブル
- **accounts**: 口座マスタ（ID, 名前, 種別, 初期残高, 現在残高）
- **account_movements**: 残高変動履歴（手動更新、取引連動）
- **asset_snapshots**: 日次資産スナップショット（総資産集計）
- **asset_forecasts**: 予測結果キャッシュ（シナリオ別）

### 関連ドメインエンティティ
- **Account集約**: 金融口座のライフサイクル管理
  - Accountエンティティ: 口座基本情報
  - AccountType列挙: 普通預金、投資信託、株式等
  - Balance値オブジェクト: 残高管理ロジック
- **AssetSnapshot集約**: 資産推移のスナップショット管理
- **AssetForecast集約**: 予測ロジックと結果キャッシュ
- **Transaction集約**: 取引と連動した資産更新

## UI/UX要件

### ビジュアル表現
- **色分け**: 口座種別ごとに色を統一
- **アイコン**: 口座種別に応じたアイコン表示
- **グラフ**: 滑らかなアニメーション遷移

### データ入力補助
- **金額入力**: 3桁区切り自動フォーマット
- **日付選択**: カレンダーUI
- **テンプレート**: よくある口座種別のプリセット

### リアルタイム性
- **自動更新**: 5分ごとにデータ同期（設定可）
- **プッシュ通知**: 大幅な変動時の通知
- **同期インジケータ**: 更新中の表示

## セキュリティ要件

### データ保護
- **暗号化**: 金額データの暗号化保存
- **アクセス制御**: 本人の口座のみ表示
- **監査ログ**: 残高変更履歴の記録

### 外部連携（将来実装）
- **API連携時**: OAuth2.0認証
- **スクレイピング**: 二要素認証対応
- **データ保持**: 最小限の認証情報のみ

## ビジネスロジック

### 資産計算
- **為替換算**: 外貨資産の円換算
- **時価評価**: 投資商品の最新価格反映
- **手数料考慮**: 実質残高での計算

### 簡易予測アルゴリズム
- **考慮要素**:
  - 過去の資産増減トレンド
  - 収支パターン
  - 季節変動
  - 投資リターン想定
- **シナリオ別想定**:
  - 楽観的: 年率5%成長
  - 現実的: 過去実績ベース
  - 悲観的: 年率-2%想定

## 実装優先順位
1. 基本的な口座管理機能
2. 総資産表示と内訳
3. 手動での残高更新
4. 資産推移グラフ
5. 簡易予測機能

## 画面設計（ASCII）

```
+--------------------------------------------------------------------------------------------------+
|  FinSight                                                               AI User | Premium Plan    |
+----------------+---------------------------------------------------------------------------------+
| ≡ Dashboard    |                              Assets Management                                  |
|                |                                                                                 |
| 📊 Transactions |  +--------------------------------------------------------------------+          |
|                |  |                      Total Assets                                  |          |
| 💰 Budget       |  |                                                                  |          |
|                |  |                      ¥1,500,000                                   |          |
| 📈 Assets       |  |                                                                  |          |
|                |  |                   ▲ +¥50,000 (+3.4%)                              |          |
| 📑 Reports      |  +--------------------------------------------------------------------+          |
|                |                                                                                 |
| ⚙️ Settings     |  Asset Breakdown                              Simple Asset Forecast           |
|                |  +------------------------------------------+  +-------------------------------+|
|                |  | Account Name    | Type      | Balance     |  | 📊 Simple Asset Prediction     ||
|                |  |-----------------|-----------|-------------|  |                               ||
|                |  | Regular Savings | 普通預金   | ¥1,200,000  |  | Forecast Period:              ||
|                |  | (みずほ銀行)     |           | 80.0%       |  | [1 Year ▼]                   ||
|                |  |                 |           | ▲ +¥20,000  |  |                               ||
|                |  |-----------------|-----------|-------------|  | Scenario:                     ||
|                |  | Investment Trust| 投資信託   | ¥250,000    |  | [Realistic ▼]                ||
|                |  | (SBI証券)       |           | 16.7%       |  |                               ||
|                |  |                 |           | ▲ +¥25,000  |  | Predicted Assets:             ||
|                |  |-----------------|-----------|-------------|  | ¥1,680,000                   ||
|                |  | Stocks          | 株式      | ¥50,000     |  | (+12.0%)                      ||
|                |  | (楽天証券)       |           | 3.3%        |  |                               ||
|                |  |                 |           | ▲ +¥5,000   |  | Assumptions:                  ||
|                |  +------------------------------------------+  | • Monthly savings: ¥50,000   ||
|                |                                                | • Investment return: 5%/year  ||
|                |  Asset Trend (Past 6 Months)                  | • No major expenses expected  ||
|                |  +------------------------------------------+  |                               ||
|                |  | 1.6M┤      ╱────────                      |  | [Start Forecast]              ||
|                |  |     │    ╱─╱                              |  +-------------------------------+|
|                |  | 1.4M┤  ╱──╱                                |                                   |
|                |  |     │╱──╱                                  |  [+ Add Account]                  |
|                |  | 1.2M┤──╱                                    |                                   |
|                |  |      Jun  Jul  Aug  Sep  Oct  Nov          |                                   |
|                |  +------------------------------------------+                                   |
+----------------+---------------------------------------------------------------------------------+
```

### 画面要素説明

#### 総資産表示エリア（上部）
- **大型数値表示**: 全口座の合計額
- **前月比**: 増減額と増減率
- **トレンドアイコン**: ▲（増加）/▼（減少）

#### 資産内訳テーブル（左側）
- **列構成**:
  - 口座名（金融機関名）
  - 口座種別（日本語表記）
  - 現在残高・構成比率・前月比
- **視覚的要素**:
  - 増加は緑色、減少は赤色
  - 構成比率は薄いグレーで表示

#### 資産推移グラフ（左下）
- **期間**: 過去6ヶ月のトレンド
- **グラフタイプ**: 折れ線グラフ
- **Y軸**: 金額（M = Million）
- **X軸**: 月表示

#### 簡易資産予測パネル（右側）
- **予測パラメータ**:
  - 期間選択（1年/3年/5年）
  - シナリオ選択（楽観的/現実的/悲観的）
- **予測結果**:
  - 予測資産額
  - 増加率
- **前提条件**: 箇条書きで表示
- **アクションボタン**: 予測開始

#### その他の機能
- **口座追加ボタン**: 右下に配置