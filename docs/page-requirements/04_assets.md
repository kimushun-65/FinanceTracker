# 資産管理ページ 設計書

## ページ概要
複数の金融口座を統合管理し、総資産の把握と将来予測を行うページです。預金、投資信託、株式などの資産を一元管理します。

## 主要機能

### コアビジネス機能
- **総合資産管理**: 複数口座の一元管理と総資産把握
- **資産推移分析**: 時系列データによる資産変動の可視化
- **AI予測エンジン**: 過去データベースの将来資産予測
- **多種口座対応**: 預金・投資・株式等の統合管理

### 1. 総資産表示
- **大型数値表示**: 全口座の合計資産額
- **前月比**: 増減額と増減率（%）
- **更新日時**: 最終データ同期日時

### 2. 資産内訳リスト
- **表示項目（各口座）**:
  - 口座名称
  - 口座種別（普通預金、投資信託、株式等）
  - 現在残高
  - 構成比率（%）
  - 前月比増減
- **並び替え**: 残高順、種別順、名称順
- **グルーピング**: 種別ごとにグループ化表示

### 3. 口座管理機能
- **口座追加**:
  - 口座名称入力
  - 口座種別選択
  - 初期残高設定
- **口座編集**: 名称変更、残高更新
- **口座削除**: 確認後に削除（取引履歴は保持）
- **手動更新**: 残高の手動入力・更新

### 4. 資産推移グラフ
- **グラフタイプ**: 面グラフ（積み上げ）
- **表示期間**: 1ヶ月、3ヶ月、6ヶ月、1年、全期間
- **表示内容**: 口座種別ごとの推移
- **インタラクティブ**: ホバーで詳細表示

### 5. 簡易資産予測機能
- **予測開始ボタン**: 将来の資産額簡易予測を実行
- **予測パラメータ**:
  - 予測期間（1年、3年、5年）
  - シナリオ（楽観的、現実的、悲観的）
- **予測結果表示**:
  - 予測資産額
  - 予測グラフ
  - 前提条件の説明

## 対応API・テーブル・ドメイン情報

### 関連API
1. **GET /accounts**
   - 全口座一覧取得
   - レスポンス: 口座情報、current_balance（現在残高）
   - ページネーション対応

2. **POST /accounts**
   - 新規口座作成
   - リクエスト: name（口座名）、initial_balance（初期残高）
   - レスポンス: 作成された口座情報（IDとcurrent_balance含む）

3. **PUT /accounts/{accountId}**
   - 口座情報更新（名前変更のみ）
   - 残高更新は別エンドポイント

4. **DELETE /accounts/{accountId}**
   - 口座削除
   - 関連取引・資産スナップショットの処理

5. **POST /accounts/{accountId}/movements**
   - 残高更新（変動記録として）
   - リクエスト: amount（変動額）、note（メモ/任意）
   - 変更履歴として記録され、current_balanceが更新される

6. **GET /assets/snapshots**
   - 資産推移履歴取得（グラフ用）
   - パラメータ: from（開始日）、to（終了日）、page、limit
   - レスポンス: 
     - snapshots: 日付ごとの資産スナップショット配列
     - total_assets: 総資産額
     - change_from_previous: 前回からの変動額
     - accounts_breakdown: 口座別の残高内訳

### 対応テーブル
- **accounts**: 口座マスタ（ID, 名前, 種別, 初期残高, 現在残高）
- **account_movements**: 残高変動履歴（手動更新、取引連動）
- **asset_snapshots**: 日次資産スナップショット（総資産集計）
- **asset_forecasts**: 予測結果キャッシュ（シナリオ別）

### 関連ドメインエンティティ
- **Account集約**: 金融口座のライフサイクル管理
  - Accountエンティティ: 口座基本情報
  - AccountType列挙: 普通預金、投資信託、株式等
  - Balance値オブジェクト: 残高管理ロジック
- **AssetSnapshot集約**: 資産推移のスナップショット管理
- **AssetForecast集約**: 予測ロジックと結果キャッシュ
- **Transaction集約**: 取引と連動した資産更新

## UI/UX要件

### ビジュアル表現
- **色分け**: 口座種別ごとに色を統一
- **アイコン**: 口座種別に応じたアイコン表示
- **グラフ**: 滑らかなアニメーション遷移

### データ入力補助
- **金額入力**: 3桁区切り自動フォーマット
- **日付選択**: カレンダーUI
- **テンプレート**: よくある口座種別のプリセット

### リアルタイム性
- **自動更新**: 5分ごとにデータ同期（設定可）
- **プッシュ通知**: 大幅な変動時の通知
- **同期インジケータ**: 更新中の表示

## セキュリティ要件

### データ保護
- **暗号化**: 金額データの暗号化保存
- **アクセス制御**: 本人の口座のみ表示
- **監査ログ**: 残高変更履歴の記録

### 外部連携（将来実装）
- **API連携時**: OAuth2.0認証
- **スクレイピング**: 二要素認証対応
- **データ保持**: 最小限の認証情報のみ

## ビジネスロジック

### 資産計算
- **為替換算**: 外貨資産の円換算
- **時価評価**: 投資商品の最新価格反映
- **手数料考慮**: 実質残高での計算


## 実装優先順位
1. 基本的な口座管理機能
2. 総資産表示と内訳
3. 手動での残高更新
4. 資産推移グラフ
5. 簡易予測機能

## 画面設計（ASCII）

```
+--------------------------------------------------------------------------------------------------+
|  FinSight                                                               AI User | Premium Plan    |
+----------------+---------------------------------------------------------------------------------+
| ≡ Dashboard    |                              Assets Management                                  |
|                |                                                                                 |
| 📊 Transactions |  +--------------------------------------------------------------------+          |
|                |  |                      Total Assets                                  |          |
| 💰 Budget       |  |                                                                  |          |
|                |  |                      ¥1,500,000                                   |          |
| 📈 Assets       |  |                                                                  |          |
|                |  |                   ▲ +¥50,000 (+3.4%)                              |          |
| 📑 Reports      |  +--------------------------------------------------------------------+          |
|                |                                                                                 |
| ⚙️ Settings     |  Asset List                                                                      |
|                |  +--------------------------------------------------------------------+          |
|                |  | Asset Name           | Type          | Balance       | % | Change       |          |
|                |  |--------------------|---------------|---------------|---|--------------|          |
|                |  | みずほ銀行            | 🏛️ 普通預金    | ¥1,200,000    | 80% | ▲ +¥20,000   |          |
|                |  | SBI証券            | 📊 投資信託    | ¥250,000      | 17% | ▲ +¥25,000   |          |
|                |  | 楽天証券           | 💹 株式        | ¥50,000       | 3%  | ▲ +¥5,000    |          |
|                |  +--------------------------------------------------------------------+          |
|                |  | [+ Add Asset]  [Update Balances]                                   |          |
|                |  +--------------------------------------------------------------------+          |
|                |                                                                                 |
|                |  Total Asset Trend                                                               |
|                |  +--------------------------------------------------------------------+          |
|                |  |       [1M] [3M] [6M] [1Y] [All]                                     |          |
|                |  |                                                                    |          |
|                |  | 1.6M│                                               ●              |          |
|                |  |      │                                           ●───◦              |          |
|                |  | 1.5M│                                      ●───◦                   |          |
|                |  |      │                                 ●───◦                        |          |
|                |  | 1.4M│                            ●───◦                             |          |
|                |  |      │                       ●───◦                                  |          |
|                |  | 1.3M│                  ●───◦                                       |          |
|                |  |      │──────────────────────────────────────────────────────────│          |
|                |  |       Jun      Jul      Aug      Sep      Oct      Nov      Dec    |          |
|                |  +--------------------------------------------------------------------+          |
|                |  | Last updated: 2025-12-15 14:30                                     |          |
|                |  +--------------------------------------------------------------------+          |
|                |                                                                                 |
+----------------+---------------------------------------------------------------------------------+
```

### 画面要素説明

#### 総資産表示エリア（上部）
- **大型数値表示**: 全口座の合計額
- **前月比**: 増減額と増減率
- **トレンドアイコン**: ▲（増加）/▼（減少）

#### 資産内訳テーブル（左側）
- **列構成**:
  - 口座名（金融機関名）
  - 口座種別（日本語表記）
  - 現在残高・構成比率・前月比
- **視覚的要素**:
  - 増加は緑色、減少は赤色
  - 構成比率は薄いグレーで表示

#### 資産推移グラフ（左下）
- **期間**: 過去6ヶ月のトレンド
- **グラフタイプ**: 折れ線グラフ
- **Y軸**: 金額（M = Million）
- **X軸**: 月表示

#### 簡易資産予測パネル（右側）
- **予測パラメータ**:
  - 期間選択（1年/3年/5年）
  - シナリオ選択（楽観的/現実的/悲観的）
- **予測結果**:
  - 予測資産額
  - 増加率
- **前提条件**: 箇条書きで表示
- **アクションボタン**: 予測開始

#### その他の機能
- **口座追加ボタン**: 右下に配置