# 取引ページ 設計書

## ページ概要
収入・支出の取引を記録・管理するページです。取引の一覧表示、新規取引の追加、既存取引の編集・削除機能を提供します。

## 主要機能

### コアビジネス機能
- **取引記録管理**: 日々の収入・支出の網羅的記録
- **リアルタイム集計**: 取引追加・編集時の即座反映
- **柔軟なフィルタリング**: 多層的な検索・絞り込み機能
- **バッチ操作**: 複数取引の一括処理

### 1. 取引サマリー
- **月間収入**: 当月の収入合計額
- **月間支出**: 当月の支出合計額
- **純収入**: 収入 - 支出の差額

### 2. 取引一覧
- **表示項目**:
  - 日付
  - 説明・店舗名
  - カテゴリ（色分けタグ）
  - 金額（支出は赤、収入は緑）
  - 取引種別アイコン（↓支出、↑収入）
- **ソート機能**: 日付、金額、カテゴリ別
- **フィルタ機能**: 
  - 期間指定
  - カテゴリ別
  - 収入/支出別
- **ページネーション**: 20件/ページ

### 3. 取引追加パネル
- **入力項目**:
  - 取引種別（支出/収入トグル）
  - 金額
  - カテゴリ（ドロップダウン）
  - 日付（デートピッカー）
  - 説明・メモ（任意）
- **バリデーション**:
  - 金額: 必須、正の数値
  - カテゴリ: 必須選択
  - 日付: 必須、未来日付は警告表示

### 4. 取引編集・削除
- **編集**: 各取引行のクリックで編集モード
- **削除**: 確認ダイアログ表示後に削除
- **一括操作**: 複数選択して一括削除

## 対応API・テーブル・ドメイン情報

### 関連API
1. **GET /transactions**
   - 取引一覧取得（フィルタ・ページング対応）
   - パラメータ: page, limit, from, to, category_id, type
   - レスポンス: 取引リスト、ページング情報

2. **POST /transactions**
   - 取引新規作成
   - リクエスト: type, amount, category_id, transaction_date, description
   - バリデーション、事業ロジック処理を含む

3. **PUT /transactions/{id}**
   - 取引情報更新
   - 排他制御で同時編集防止

4. **DELETE /transactions/{id}**
   - 取引削除（論理削除）
   - 関連予算・集計情報の更新を伴う

5. **GET /transactions/summary/monthly**
   - 月間サマリー取得（上部カード表示用）
   - 収入・支出・純収入の計算

6. **GET /categories**
   - カテゴリ一覧取得（選択リスト用）

### 対応テーブル
- **transactions**: 取引メインテーブル（ID, ユーザー, カテゴリ, 金額, 日付, 説明）
- **categories**: カテゴリマスタ（名前、色、アイコン情報）
- **recurring_transactions**: 定期取引テンプレート（月次自動生成用）

### 関連ドメインエンティティ
- **Transaction集約**: 取引のライフサイクル管理（作成・更新・削除）
  - Transactionエンティティ: 基本取引情報
  - Money値オブジェクト: 金額のビジネスルール
  - TransactionType列挙: income/expenseの管理
- **Category集約**: カテゴリ管理・分類ロジック
- **RecurringTransaction集約**: 定期取引のテンプレート管理
- **User集約**: ユーザー固有の取引データアクセス制御

## UI/UX要件

### インタラクション
- **リアルタイム更新**: 追加・編集後即座に一覧反映
- **ローディング表示**: API通信中の表示
- **エラーハンドリング**: 
  - ネットワークエラー時の再試行
  - バリデーションエラーの分かりやすい表示

### ユーザビリティ
- **ショートカット**: 
  - Ctrl+N: 新規取引追加
  - Delete: 選択取引削除
- **自動補完**: 過去の取引から店舗名サジェスト
- **デフォルト値**: 
  - 日付: 今日
  - 取引種別: 支出

## セキュリティ要件
- **認証**: ログインユーザーの取引のみ表示
- **CSRF対策**: トークン検証
- **入力値検証**: SQLインジェクション対策

## 実装優先順位
1. 取引一覧表示
2. 取引追加機能
3. サマリー表示
4. 編集・削除機能
5. フィルタ・ソート機能

## 画面設計（ASCII）

```
+--------------------------------------------------------------------------------------------------+
|  FinSight                                                               AI User | Premium Plan    |
+----------------+---------------------------------------------------------------------------------+
| ≡ Dashboard    |                              Transactions                                       |
|                |                                                                                 |
| 📊 Transactions | +----------------+  +----------------+  +----------------+                     |
|                | | Monthly Income |  | Monthly Expense|  | Net Income     |                     |
| 💰 Budget       | |                |  |                |  |                |                     |
|                | |      ¥0        |  |   ¥106,672    |  |   -¥106,672    |                     |
| 📈 Assets       | +----------------+  +----------------+  +----------------+                     |
|                |                                                                                 |
| 📑 Reports      | Transaction List                                        Add Transaction        |
|                | +-----------------------------------------------+    +-----------------------+ |
| ⚙️ Settings     | | Date    | Description      | Category | Amount |    | [Expense] Income     | |
|                | +-----------------------------------------------+    |                       | |
|                | | 09/30   | スーパー          | 🍎 Food  | ↓¥7,450 |    | Amount:              | |
|                | | 09/29   | Amazon           | 🛍️ Shop  | ↓¥3,280 |    | ¥ [_______________]  | |
|                | | 09/29   | 電気代           | ⚡ Util  | ↓¥5,073 |    |                       | |
|                | | 09/28   | カフェ           | 🍎 Food  | ↓¥1,200 |    | Category:            | |
|                | | 09/27   | 電車賃           | 🚃 Trans | ↓¥440   |    | [Food         ▼]    | |
|                | | 09/27   | ランチ           | 🍎 Food  | ↓¥890   |    |                       | |
|                | | 09/26   | Netflix          | 🎬 Ent   | ↓¥1,490 |    | Date:                | |
|                | | 09/25   | コンビニ         | 🍎 Food  | ↓¥523   |    | [2025/09/30    📅]  | |
|                | | 09/25   | 書籍             | 📚 Edu   | ↓¥2,420 |    |                       | |
|                | | 09/24   | ガソリン         | 🚗 Trans | ↓¥5,230 |    | Note:                | |
|                | +-----------------------------------------------+    | [_______________]    | |
|                |                                                       |                       | |
|                | [◀ Previous] Page 1 of 5 [Next ▶]                   | [   Add (追加する)  ] | |
|                |                                                       +-----------------------+ |
+----------------+---------------------------------------------------------------------------------+
```

### 画面要素説明

#### 上部サマリーエリア
- 3つのカード形式で表示
- 月間収入（緑）、月間支出（赤）、純収入（収支に応じて色変更）

#### 取引一覧（左側メインエリア）
- テーブル形式での表示
- カテゴリはアイコンと色で識別
- 金額は支出（↓赤）、収入（↑緑）で表示
- 各行はホバーで背景色変更
- クリックで編集モード

#### 取引追加パネル（右側）
- 固定位置のサイドパネル
- 支出/収入のトグルスイッチ
- 金額入力は数値のみ受付
- カテゴリはドロップダウン
- 日付はカレンダーピッカー
- 追加ボタンは入力完了で活性化

#### ページネーション
- 下部中央に配置
- 前後ページへの移動ボタン
- 現在ページ/総ページ数表示