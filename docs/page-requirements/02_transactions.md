# 取引ページ 設計書

## ページ概要
収入・支出の取引を記録・管理するページです。取引の一覧表示、新規取引の追加、既存取引の編集・削除機能を提供します。

## 主要機能

### 1. 取引サマリー
- **月間収入**: 当月の収入合計額
- **月間支出**: 当月の支出合計額
- **純収入**: 収入 - 支出の差額

### 2. 取引一覧
- **表示項目**:
  - 日付
  - 説明・店舗名
  - カテゴリ（色分けタグ）
  - 金額（支出は赤、収入は緑）
  - 取引種別アイコン（↓支出、↑収入）
- **ソート機能**: 日付、金額、カテゴリ別
- **フィルタ機能**: 
  - 期間指定
  - カテゴリ別
  - 収入/支出別
- **ページネーション**: 20件/ページ

### 3. 取引追加パネル
- **入力項目**:
  - 取引種別（支出/収入トグル）
  - 金額
  - カテゴリ（ドロップダウン）
  - 日付（デートピッカー）
  - 説明・メモ（任意）
- **バリデーション**:
  - 金額: 必須、正の数値
  - カテゴリ: 必須選択
  - 日付: 必須、未来日付は警告表示

### 4. 取引編集・削除
- **編集**: 各取引行のクリックで編集モード
- **削除**: 確認ダイアログ表示後に削除
- **一括操作**: 複数選択して一括削除

## データ取得要件

### 必要なAPI
1. **取引一覧取得API**
   - エンドポイント: `/api/transactions`
   - パラメータ: 
     - page: ページ番号
     - limit: 表示件数
     - from: 開始日
     - to: 終了日
     - category_id: カテゴリID
     - type: income/expense
   - レスポンス: 取引リスト、ページング情報

2. **取引追加API**
   - エンドポイント: `/api/transactions`
   - メソッド: POST
   - リクエスト:
     ```json
     {
       "type": "expense",
       "amount": 1000,
       "category_id": "uuid",
       "transaction_date": "2025-01-01",
       "description": "コンビニ"
     }
     ```

3. **取引更新API**
   - エンドポイント: `/api/transactions/{id}`
   - メソッド: PUT

4. **取引削除API**
   - エンドポイント: `/api/transactions/{id}`
   - メソッド: DELETE

### データベース参照
- `transactions`テーブル: 取引データ
- `categories`テーブル: カテゴリ情報

## UI/UX要件

### インタラクション
- **リアルタイム更新**: 追加・編集後即座に一覧反映
- **ローディング表示**: API通信中の表示
- **エラーハンドリング**: 
  - ネットワークエラー時の再試行
  - バリデーションエラーの分かりやすい表示

### ユーザビリティ
- **ショートカット**: 
  - Ctrl+N: 新規取引追加
  - Delete: 選択取引削除
- **自動補完**: 過去の取引から店舗名サジェスト
- **デフォルト値**: 
  - 日付: 今日
  - 取引種別: 支出

## セキュリティ要件
- **認証**: ログインユーザーの取引のみ表示
- **CSRF対策**: トークン検証
- **入力値検証**: SQLインジェクション対策

## 実装優先順位
1. 取引一覧表示
2. 取引追加機能
3. サマリー表示
4. 編集・削除機能
5. フィルタ・ソート機能

## 画面設計（ASCII）

```
+--------------------------------------------------------------------------------------------------+
|  FinSight                                                               AI User | Premium Plan    |
+----------------+---------------------------------------------------------------------------------+
| ≡ Dashboard    |                              Transactions                                       |
|                |                                                                                 |
| 📊 Transactions | +----------------+  +----------------+  +----------------+                     |
|                | | Monthly Income |  | Monthly Expense|  | Net Income     |                     |
| 💰 Budget       | |                |  |                |  |                |                     |
|                | |      ¥0        |  |   ¥106,672    |  |   -¥106,672    |                     |
| 📈 Assets       | +----------------+  +----------------+  +----------------+                     |
|                |                                                                                 |
| 📑 Reports      | Transaction List                                        Add Transaction        |
|                | +-----------------------------------------------+    +-----------------------+ |
| ⚙️ Settings     | | Date    | Description      | Category | Amount |    | [Expense] Income     | |
|                | +-----------------------------------------------+    |                       | |
|                | | 09/30   | スーパー          | 🍎 Food  | ↓¥7,450 |    | Amount:              | |
|                | | 09/29   | Amazon           | 🛍️ Shop  | ↓¥3,280 |    | ¥ [_______________]  | |
|                | | 09/29   | 電気代           | ⚡ Util  | ↓¥5,073 |    |                       | |
|                | | 09/28   | カフェ           | 🍎 Food  | ↓¥1,200 |    | Category:            | |
|                | | 09/27   | 電車賃           | 🚃 Trans | ↓¥440   |    | [Food         ▼]    | |
|                | | 09/27   | ランチ           | 🍎 Food  | ↓¥890   |    |                       | |
|                | | 09/26   | Netflix          | 🎬 Ent   | ↓¥1,490 |    | Date:                | |
|                | | 09/25   | コンビニ         | 🍎 Food  | ↓¥523   |    | [2025/09/30    📅]  | |
|                | | 09/25   | 書籍             | 📚 Edu   | ↓¥2,420 |    |                       | |
|                | | 09/24   | ガソリン         | 🚗 Trans | ↓¥5,230 |    | Note:                | |
|                | +-----------------------------------------------+    | [_______________]    | |
|                |                                                       |                       | |
|                | [◀ Previous] Page 1 of 5 [Next ▶]                   | [   Add (追加する)  ] | |
|                |                                                       +-----------------------+ |
+----------------+---------------------------------------------------------------------------------+
```

### 画面要素説明

#### 上部サマリーエリア
- 3つのカード形式で表示
- 月間収入（緑）、月間支出（赤）、純収入（収支に応じて色変更）

#### 取引一覧（左側メインエリア）
- テーブル形式での表示
- カテゴリはアイコンと色で識別
- 金額は支出（↓赤）、収入（↑緑）で表示
- 各行はホバーで背景色変更
- クリックで編集モード

#### 取引追加パネル（右側）
- 固定位置のサイドパネル
- 支出/収入のトグルスイッチ
- 金額入力は数値のみ受付
- カテゴリはドロップダウン
- 日付はカレンダーピッカー
- 追加ボタンは入力完了で活性化

#### ページネーション
- 下部中央に配置
- 前後ページへの移動ボタン
- 現在ページ/総ページ数表示